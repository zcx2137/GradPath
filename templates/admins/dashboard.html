{% extends 'admins/base.html' %}

{% load static %}

{% block extra_css %}
    <link href="{% static 'CSS/admins/dashboard.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
        
    <div class="filter-form" style="margin: 20px 0;">
        <!-- 搜索表单 -->
        <form method="get" action="{% url 'admin_dashboard' %}">
            {# 学院筛选 #}
            <select name="college" style="padding: 8px; margin-right: 10px;">
                <option value="">所有学院</option>
                {% for code, name in college_choices %}
                    <option value="{{ code }}" {% if current_college == code %}selected{% endif %}>
                        {{ name }}
                    </option>
                {% endfor %}
            </select>

            {# 年级筛选 #}
            <select name="grade" style="padding: 8px; margin-right: 10px;">
                <option value="">所有年级</option>
                {% for grade in grade_choices %}
                    <option value="{{ grade }}" {% if current_grade == grade %}selected{% endif %}>
                        {{ grade }}
                    </option>
                {% endfor %}
            </select>

            <button type="submit" style="padding: 8px 16px; background: #4a90e2; color: white; border: none; border-radius: 4px;">
                筛选
            </button>
            <a href="{% url 'admin_dashboard' %}" style="margin-left: 10px; color: #666;">重置</a>
        </form>
    </div>
    
    <h2>学生账号列表</h2>
    <!-- 学生搜索表单 -->
    <div class="search-container">
        <form method="get" class="search-form">
            <!-- 保留当前筛选条件（学院/年级） -->
            <input type="hidden" name="college" value="{{ current_college }}">
            <input type="hidden" name="grade" value="{{ current_grade }}">
            
            <input type="text" 
                   name="student_search" 
                   placeholder="搜索学生姓名或学号..." 
                   value="{{ student_search }}">
            <button type="submit" class="search-btn">搜索</button>
            {% if student_search %}
                <!-- 清除学生搜索时保留其他参数 -->
                <a href="?college={{ current_college }}&grade={{ current_grade }}" class="clear-search">清除</a>
            {% endif %}
        </form>
    </div>
    <table class="user-table">
        <tr>
            <th>ID</th>
            <th>学号</th>
            <th>姓名</th>
            <th>用户名</th>
            <th>学院</th>
            <th>年级</th>
            <th>操作</th>
        </tr>
        {% for student in students %}
        <tr>
            <td>{{ student.id }}</td>
            <td>{{ student.student_id }}</td>
            <td>{{ student.full_name }}</td>
            <td>{{ student.user.username }}</td>
            <td>{{ student.get_college_display }}</td>
            <td>{{ student.grade }}</td>
            <td>
                <a href="{% url 'edit_user' student.user.id %}" class="btn btn-edit">编辑</a>
                <a href="{% url 'reset_password' student.user.id %}" class="btn btn-reset" 
                   onclick="return confirm('确定要重置密码密码吗？')">重置密码</a>
                <a href="{% url 'delete_user' student.user.id %}" class="btn btn-delete" 
                   onclick="return confirm('确定要删除吗？')">删除</a>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">暂无学生数据</td></tr>
        {% endfor %}
    </table>

    <h2>辅导员账号列表</h2>
    <!-- 辅导员搜索表单 -->
    <div class="search-container">
        <form method="get" class="search-form">
            <!-- 保留当前筛选条件（学院/年级） -->
            <input type="hidden" name="college" value="{{ current_college }}">
            <input type="hidden" name="grade" value="{{ current_grade }}">
            
            <input type="text" 
                   name="counselor_search" 
                   placeholder="搜索辅导员姓名或工号..." 
                   value="{{ counselor_search }}">
            <button type="submit" class="search-btn">搜索</button>
            {% if counselor_search %}
                <!-- 清除辅导员搜索时保留其他参数 -->
                <a href="?college={{ current_college }}&grade={{ current_grade }}" class="clear-search">清除</a>
            {% endif %}
        </form>
    </div> 
    <table class="user-table">
        <tr>
            <th>ID</th>
            <th>工号</th>
            <th>姓名</th>
            <th>用户名</th>
            <th>学院</th>>
            <th>负责年级</th>
            <th>操作</th>
        </tr>
        {% for counselor in counselors %}
        <tr>
            <td>{{ counselor.id }}</td>
            <td>{{ counselor.employee_id }}</td>
            <td>{{ counselor.full_name }}</td>
            <td>{{ counselor.user.username }}</td>
            <td>{{ counselor.get_college_display }}</td>
            <td>{{ counselor.grade }}</td>
            <td>
                <a href="{% url 'edit_user' counselor.user.id %}" class="btn btn-edit">编辑</a>
                <a href="{% url 'reset_password' counselor.user.id %}" class="btn btn-reset" 
                   onclick="return confirm('确定要重置密码吗？')">重置密码</a>
                <a href="{% url 'delete_user' counselor.user.id %}" class="btn btn-delete"
                   onclick="return confirm('确定要删除吗？')">删除</a>
            </td>
        </tr>
        {% empty %}
        <tr><td colspan="6">暂无辅导员数据</td></tr>
        {% endfor %}
    </table>
{% endblock %}
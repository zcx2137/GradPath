{% extends 'students/base.html' %}

{% load static %}

{% block title %}提交新资料 - 保研加分小助手{% endblock %}

{% block extra_css %}
<link href="{% static 'CSS/upload.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <div class="add-item-container">
        <div class="add-item-header">
            <h1 class="add-item-title">提交新资料</h1>
            <div class="user-info">
                <span>{{ user.username|default:"用户名" }}</span>
            </div>
        </div>
        
        <form method="POST" enctype="multipart/form-data" id="add-item-form">
            {% csrf_token %}
            
            <!-- 加分类型选择 -->
            <div class="card form-section">
                <div class="card-body">
                    <h3 class="section-title">请选择加分类型</h3>
                    {{ form.category }}
                    {% if form.category.errors %}
                        <div class="error-message">{{ form.category.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- 证明材料上传 -->
            <div class="card form-section">
                <div class="card-body">
                    <h3 class="section-title">请上传证明材料</h3>
                    <div class="upload-area" id="uploadArea">
                        <div class="upload-icon">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="upload-text">点击或拖拽文件到此处上传</div>
                        <div class="upload-hint">支持格式：PDF, JPG, PNG, DOC，单个文件不超过10MB</div>
                        {{ form.file }}
                    </div>
                    <div id="fileName" class="file-name-display"></div>
                    {% if form.file.errors %}
                        <div class="error-message">{{ form.file.errors }}</div>
                    {% endif %}
                </div>
            </div>
            
            <!-- 其他表单字段 -->
            {% for field in form %}
                {% if field.name != 'category' and field.name != 'file' %}
                <div class="card form-section">
                    <div class="card-body">
                        <h3 class="section-title">{{ field.label }}</h3>
                        {{ field }}
                        {% if field.errors %}
                            <div class="error-message">{{ field.errors }}</div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
            {% endfor %}
            
            <!-- 提交按钮 -->
            <div class="submit-section">
                <button type="submit" class="btn btn-primary submit-button">提交申请</button>
            </div>
        
            <div class="navigation mt-4">
                <p>
                    <a href="{% url 'submissions' %}" class="btn btn-primary">查看我的提交</a>
                    <a href="{% url 'index' %}" class="btn btn-primary ms-2">返回主页</a>
                </p>
            </div>
        
        </form>
        
            
    </div>

    <script>
    // 点击上传区域触发文件选择
    document.getElementById('uploadArea').addEventListener('click', function() {
        document.getElementById('id_file').click();
    });

    // 显示已选择文件的名称
    document.getElementById('id_file').addEventListener('change', function(e) {
        var fileNameDisplay = document.getElementById('fileName');
        if (this.files.length > 0) {
            fileNameDisplay.textContent = '已选择文件: ' + this.files[0].name;
            fileNameDisplay.style.display = 'block';
        } else {
            fileNameDisplay.style.display = 'none';
        }
    });

    // 拖拽功能
    document.getElementById('uploadArea').addEventListener('dragover', function(e) {
        e.preventDefault();
        this.classList.add('active');
    });

    document.getElementById('uploadArea').addEventListener('dragleave', function() {
        this.classList.remove('active');
    });

    document.getElementById('uploadArea').addEventListener('drop', function(e) {
        e.preventDefault();
        this.classList.remove('active');
        
        if (e.dataTransfer.files.length > 0) {
            document.getElementById('id_file').files = e.dataTransfer.files;
            // 触发 change 事件来更新文件名显示
            var event = new Event('change');
            document.getElementById('id_file').dispatchEvent(event);
        }
    });
    </script>
{% endblock %}

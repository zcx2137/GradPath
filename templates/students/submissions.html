{% extends 'students/base.html' %}
{% load static %}

{% block title %}我的提交记录{% endblock %}

{% block extra_css %}
    <link href="{% static 'CSS/submissions.css' %}" rel="stylesheet">
{% endblock %}

{% block content %}
    <!-- 我的申请详情内容 -->
    <div class="applications-container">
        <div class="applications-header">
            <h1 class="applications-title">我的申请详情</h1>
            <div class="user-info">
                <span>{{ user.username|default:"用户名" }}</span>
            </div>
        </div>
        
        <!-- 筛选工具栏 -->
        <div class="card">
            <div class="card-body">
                <div class="filter-toolbar">
                    <select class="filter-select">
                        <option>选择状态</option>
                        <option>待审核</option>
                        <option>已通过</option>
                        <option>已拒绝</option>
                    </select>
                    
                    <select class="filter-select">
                        <option>选择类别</option>
                        <option>科研成果</option>
                        <option>学业竞赛</option>
                        <option>创新创业训练</option>
                        <option>综合表现加分</option>
                    </select>
                    
                    <input type="text" class="search-input" placeholder="搜索申请项目（暂未实现筛选和搜索功能）">
                </div>
            </div>
        </div>
        
        <!-- 申请列表 -->
        <div class="card">
            <div class="card-body">
                <table class="applications-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>加分项类型</th>
                            <th>备注</th>
                            <th>文件</th>
                            <th>自评加分</th>
                            <th>状态</th>
                            <th>审核加分</th>
                            <th>提交时间</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if submissions %}
                            {% for sub in submissions %}
                            <tr>
                                <td>{{ sub.id }}</td>
                                <td>{{ sub.get_category_display }}</td>
                                <td>{{ sub.remarks|default:"(无)" }}</td>
                                <td>
                                    {% if sub.file %}
                                        <a href="{{ sub.file.url }}" target="_blank" class="text-primary">下载查看</a>
                                    {% else %}
                                        -
                                    {% endif %}
                                </td>
                                <td>{{ sub.self_rating }}</td>
                                <td>
                                    {% if sub.approved %}
                                        <span class="status-badge status-approved">已通过</span>
                                    {% elif sub.rejected %}
                                        <span class="status-badge status-rejected">已驳回</span>
                                        {% if sub.reject_reason %}
                                            <div style="font-size: 0.8em; color: #666; margin-top: 4px;">理由: {{ sub.reject_reason }}</div>
                                        {% endif %}
                                    {% else %}
                                        <span class="status-badge status-pending">待审核</span>
                                    {% endif %}
                                </td>
                                <td>{{ sub.approved_score|default:"-" }}</td>
                                <td>{{ sub.timestamp|date:"Y-m-d H:i:s" }}</td>
                                <td>
                                    <div class="action-buttons">
                                        <a href="{% url 'delete_submission' sub.id %}" class="btn-primary btn-sm">
                                            删除
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        {% else %}
                            <!-- 空状态 -->
                            <tr>
                                <td colspan="9" class="empty-table">
                                    <div class="empty-state">
                                        <i class="fas fa-file-alt"></i>
                                        <h4>暂无申请记录</h4>
                                        <p>您还没有提交任何加分申请</p>
                                        <a href="{% url 'upload' %}" class="btn btn-primary mt-2">提交新申请</a>
                                    </div>
                                </td>
                            </tr>
                        {% endif %}
                    </tbody>
                </table>
            </div>
        </div>

        <div class="navigation mt-4">
            <p>
                <a href="{% url 'upload' %}" class="btn-primary">上传新资料</a>
                <a href="{% url 'index' %}" class="btn-primary ml-2">返回主页</a>
            </p>
        </div>
    </div>
{% endblock %}